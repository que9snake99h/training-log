<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ÂÅ•Â∫∑„É≠„Ç∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">

  <style>
    body {
      font-family: sans-serif;
      max-width: 420px;
      margin: auto;
      padding: 12px;
    }
    .hidden { display: none; }

    .date-header {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    .day-type {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }

    .weight-label { font-size: 12px; color: #666; }
    .weight-input {
      width: 100%;
      font-size: 20px;
      padding: 4px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 16px;
    }
    .row input[type="checkbox"] { transform: scale(1.4); }
    .row select, .row input[type="number"] {
      font-size: 18px;
      padding: 4px;
    }

    button {
      width: 100%;
      font-size: 18px;
      padding: 10px;
      margin-top: 12px;
    }

    .menu-item {
      display: flex;
      justify-content: space-between;
      font-size: 18px;
      margin: 8px 0;
    }

    .tab {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
  </style>
</head>
<body>

<!-- ===== ÂÖ•ÂäõÁîªÈù¢ ===== -->
<div id="inputView">
  <div class="date-header" id="dateText"></div>
  <div class="day-type" id="dayType"></div>

  <input type="date" id="date" hidden>

  <div class="weight-label">‰ΩìÈáç</div>
  <input type="number" id="weight" class="weight-input" step="0.1" value="63">

  <div id="training">
    <div class="row">
      <input type="checkbox" id="trainDone">
      <select id="menuSelect"></select>
      <input type="number" id="count" placeholder="ÂõûÊï∞">
    </div>
  </div>

  <div id="stretch" class="hidden">
    <div class="row">
      <input type="checkbox" id="stretchDone">
      <span>È†≠ È¶ñ ËÇ© ËÉå ËÖ∞ Ë∂≥</span>
    </div>
  </div>

  <button onclick="save()">‰øùÂ≠ò</button>
</div>

<!-- ===== „É°„Éã„É•„ÉºÁ∑®ÈõÜÁîªÈù¢ ===== -->
<div id="menuView" class="hidden">
  <h2>„Éà„É¨„Éº„Éã„É≥„Ç∞„É°„Éã„É•„Éº</h2>
  <div id="menuList"></div>

  <input type="text" id="newMenu" placeholder="Êñ∞„Åó„ÅÑ„É°„Éã„É•„Éº">
  <button onclick="addMenu()">ËøΩÂä†</button>
</div>

<!-- ===== „Çø„Éñ ===== -->
<div class="tab">
  <button onclick="showInput()">üìù</button>
  <button onclick="showMenu()">‚öôÔ∏è</button>
</div>

<script>
  const today = new Date().toISOString().slice(0, 10);
  date.value = today;

  function isTrainingDay(d) {
    return new Date(d).getDate() % 2 === 0;
  }

  function getMenus() {
    const m = localStorage.getItem("trainingMenus");
    if (m) return JSON.parse(m);
    const defaults = ["ËÖïÁ´ã„Å¶", "ËÖπÁ≠ã", "„Çπ„ÇØ„ÉØ„ÉÉ„Éà"];
    localStorage.setItem("trainingMenus", JSON.stringify(defaults));
    return defaults;
  }

  function setMenus(menus) {
    localStorage.setItem("trainingMenus", JSON.stringify(menus));
    renderMenuSelect();
    renderMenuList();
  }

  function renderMenuSelect() {
    const menus = getMenus();
    menuSelect.innerHTML = `<option value="">ÂÜÖÂÆπ</option>`;
    menus.forEach(m => {
      const opt = document.createElement("option");
      opt.textContent = m;
      menuSelect.appendChild(opt);
    });
  }

  function renderMenuList() {
    const menus = getMenus();
    menuList.innerHTML = "";
    menus.forEach((m, i) => {
      const div = document.createElement("div");
      div.className = "menu-item";
      div.innerHTML = `${m} <span onclick="removeMenu(${i})">√ó</span>`;
      menuList.appendChild(div);
    });
  }

  function addMenu() {
    const v = newMenu.value.trim();
    if (!v) return;
    const menus = getMenus();
    menus.push(v);
    setMenus(menus);
    newMenu.value = "";
  }

  function removeMenu(i) {
    const menus = getMenus();
    menus.splice(i, 1);
    setMenus(menus);
  }

  function updateUI() {
    const d = date.value;
    dateText.textContent = d;
    const t = isTrainingDay(d);
    dayType.textContent = t ? "„Éà„É¨„Éº„Éã„É≥„Ç∞" : "„Çπ„Éà„É¨„ÉÉ„ÉÅ";
    training.classList.toggle("hidden", !t);
    stretch.classList.toggle("hidden", t);
  }

  function save() {
    const d = date.value;
    const t = isTrainingDay(d);
    const r = { date: d, weight: weight.value, type: t ? "training" : "stretch" };
    if (t) {
      r.done = trainDone.checked;
      r.menu = menuSelect.value;
      r.count = count.value;
    }
    localStorage.setItem(d, JSON.stringify(r));
    alert("‰øùÂ≠ò„Åó„Åæ„Åó„Åü");
  }

  function showInput() {
    inputView.classList.remove("hidden");
    menuView.classList.add("hidden");
  }

  function showMenu() {
    inputView.classList.add("hidden");
    menuView.classList.remove("hidden");
    renderMenuList();
  }

  renderMenuSelect();
  updateUI();

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>

</body>
</html>
